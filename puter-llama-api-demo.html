<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âú∞Áã±‰πãÈó® - Llama API ÊºîÁ§∫ | Puter.js ÂÖçË¥πËÆøÈóÆ Meta Llama Ê®°Âûã</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 50%, #2a0a0a 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 0;
            background: linear-gradient(45deg, #ff4444, #ff6666, #ff8888);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255, 68, 68, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 68, 68, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .panel h3 {
            color: #ff6666;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .model-selector {
            margin-bottom: 20px;
        }

        .model-selector select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ff4444;
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            font-size: 16px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #ff8888;
            font-weight: 500;
        }

        .input-group textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ff4444;
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff4444, #ff6666);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #ff6666, #ff8888);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid #ff4444;
        }

        .btn-secondary:hover {
            background: rgba(255, 68, 68, 0.2);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 10px 15px;
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            border-radius: 6px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .preset-btn:hover {
            background: rgba(255, 68, 68, 0.3);
            transform: translateY(-1px);
        }

        .response-area {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            border: 1px solid #ff4444;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-y: auto;
            max-height: 400px;
        }

        .loading {
            display: none;
            text-align: center;
            color: #ff6666;
            font-style: italic;
        }

        .loading.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 68, 68, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid #ff4444;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ff6666;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #cccccc;
            font-size: 0.9em;
        }

        .model-info {
            background: rgba(255, 68, 68, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #ff4444;
        }

        .model-info h4 {
            color: #ff6666;
            margin-bottom: 8px;
        }

        .model-info p {
            color: #cccccc;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .history-panel {
            grid-column: 1 / -1;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #ff4444;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-model {
            color: #ff6666;
            font-weight: bold;
        }

        .history-time {
            color: #888888;
            font-size: 0.8em;
        }

        .history-prompt {
            color: #cccccc;
            margin-bottom: 8px;
            font-style: italic;
        }

        .history-response {
            color: #ffffff;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .comparison-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #ff4444;
        }

        .comparison-header {
            color: #ff6666;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .response-time {
            color: #888888;
            font-size: 0.8em;
        }

        .streaming-indicator {
            display: none;
            color: #ff6666;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .streaming-indicator.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                min-width: auto;
            }
        }

        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            color: #ff6666;
        }

        .success-message {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #44ff44;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            color: #44ff44;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Âú∞Áã±‰πãÈó® - Llama API ÊºîÁ§∫</h1>
            <p>‰ΩøÁî® Puter.js ÂÖçË¥πËÆøÈóÆ Meta ÁöÑÊâÄÊúâ Llama Ê®°Âûã - Êó†ÈúÄ API ÂØÜÈí•ÔºåÊó†‰ΩøÁî®ÈôêÂà∂</p>
        </div>

        <!-- ÁªüËÆ°Èù¢Êùø -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalRequests">0</div>
                <div class="stat-label">ÊÄªËØ∑Ê±ÇÊï∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="modelsUsed">0</div>
                <div class="stat-label">Â∑≤Áî®Ê®°ÂûãÊï∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgResponseTime">0ms</div>
                <div class="stat-label">Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTokens">0</div>
                <div class="stat-label">ÊÄªÁîüÊàêÂ≠óÁ¨¶Êï∞</div>
            </div>
        </div>

        <div class="main-grid">
            <!-- ÂçïÊ®°ÂûãËÅäÂ§©Èù¢Êùø -->
            <div class="panel">
                <h3>ü¶ô Llama Ê®°ÂûãËÅäÂ§©</h3>
                
                <div class="model-selector">
                    <select id="llamaModel">
                        <option value="meta-llama/llama-4-maverick">Llama 4 Maverick (ÊúÄÊñ∞ÊóóËà∞)</option>
                        <option value="meta-llama/llama-3.3-70b-instruct">Llama 3.3 70B (Â§çÊùÇ‰ªªÂä°)</option>
                        <option value="meta-llama/llama-3.1-8b-instruct">Llama 3.1 8B (Âø´ÈÄüÂìçÂ∫î)</option>
                        <option value="meta-llama/llama-guard-3-8b">Llama Guard 3 8B (ÂÜÖÂÆπÂÆ°Ê†∏)</option>
                    </select>
                </div>

                <div id="modelInfo" class="model-info">
                    <h4>Llama 4 Maverick</h4>
                    <p>Meta ÊúÄÊñ∞ÁöÑÊóóËà∞Á∫ßËØ≠Ë®ÄÊ®°ÂûãÔºåÂÖ∑ÊúâÂçìË∂äÁöÑÊé®ÁêÜËÉΩÂäõÂíåÂàõÈÄ†ÊÄßÔºåÈÄÇÂêàÂ§çÊùÇÁöÑÊñáÊú¨ÁîüÊàê„ÄÅÂàÜÊûêÂíåÂàõ‰Ωú‰ªªÂä°„ÄÇ</p>
                </div>

                <div class="preset-buttons">
                    <button class="preset-btn" onclick="setPresetPrompt('creative')">ÂàõÊÑèÂÜô‰Ωú</button>
                    <button class="preset-btn" onclick="setPresetPrompt('technical')">ÊäÄÊúØËß£Èáä</button>
                    <button class="preset-btn" onclick="setPresetPrompt('analysis')">Ê∑±Â∫¶ÂàÜÊûê</button>
                    <button class="preset-btn" onclick="setPresetPrompt('coding')">ÁºñÁ®ãÂä©Êâã</button>
                    <button class="preset-btn" onclick="setPresetPrompt('moderation')">ÂÜÖÂÆπÂÆ°Ê†∏</button>
                    <button class="preset-btn" onclick="setPresetPrompt('tutorial')">ÊïôÁ®ãÁîüÊàê</button>
                </div>

                <div class="input-group">
                    <label for="userPrompt">ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢òÊàñ‰ªªÂä°Ôºö</label>
                    <textarea id="userPrompt" placeholder="‰æãÂ¶ÇÔºöËß£ÈáäÊú∫Âô®Â≠¶‰π†Â¶Ç‰ΩïÂ∑•‰Ωú..."></textarea>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="sendLlamaRequest()">ÂèëÈÄÅËØ∑Ê±Ç</button>
                    <button class="btn btn-secondary" onclick="sendStreamingRequest()">ÊµÅÂºèÂìçÂ∫î</button>
                    <button class="btn btn-secondary" onclick="clearResponse()">Ê∏ÖÁ©∫ÂìçÂ∫î</button>
                </div>

                <div class="loading" id="loading">üîÑ Ê≠£Âú®ÁîüÊàêÂìçÂ∫î...</div>
                <div class="streaming-indicator" id="streamingIndicator">üì° ÊµÅÂºèÂìçÂ∫î‰∏≠...</div>
                
                <div class="response-area" id="responseArea">Á≠âÂæÖÊÇ®ÁöÑËæìÂÖ•...</div>
            </div>

            <!-- Ê®°ÂûãÂØπÊØîÈù¢Êùø -->
            <div class="panel">
                <h3>‚öîÔ∏è Ê®°ÂûãÂØπÊØîÊµãËØï</h3>
                
                <div class="input-group">
                    <label for="comparisonPrompt">ÂØπÊØîÊµãËØïÊèêÁ§∫ËØçÔºö</label>
                    <textarea id="comparisonPrompt" placeholder="ËæìÂÖ•‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂêåÊó∂ÊµãËØïÂ§ö‰∏™Ê®°ÂûãÁöÑÂìçÂ∫î..."></textarea>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="runComparison()">ÂºÄÂßãÂØπÊØî</button>
                    <button class="btn btn-secondary" onclick="clearComparison()">Ê∏ÖÁ©∫ÂØπÊØî</button>
                </div>

                <div class="loading" id="comparisonLoading">üîÑ Ê≠£Âú®ÂØπÊØîÂ§ö‰∏™Ê®°Âûã...</div>
                
                <div class="comparison-grid" id="comparisonResults">
                    <!-- ÂØπÊØîÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
            </div>
        </div>

        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÈù¢Êùø -->
        <div class="panel history-panel">
            <h3>üìö ÂØπËØùÂéÜÂè≤ËÆ∞ÂΩï</h3>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="exportHistory()">ÂØºÂá∫ÂéÜÂè≤</button>
                <button class="btn btn-secondary" onclick="clearHistory()">Ê∏ÖÁ©∫ÂéÜÂè≤</button>
            </div>
            <div id="historyContainer">
                <p style="color: #888; text-align: center; padding: 20px;">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</p>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let stats = {
            totalRequests: 0,
            modelsUsed: new Set(),
            responseTimes: [],
            totalTokens: 0
        };

        let history = JSON.parse(localStorage.getItem('llamaHistory') || '[]');

        // Ê®°Âûã‰ø°ÊÅØ
        const modelInfo = {
            'meta-llama/llama-4-maverick': {
                name: 'Llama 4 Maverick',
                description: 'Meta ÊúÄÊñ∞ÁöÑÊóóËà∞Á∫ßËØ≠Ë®ÄÊ®°ÂûãÔºåÂÖ∑ÊúâÂçìË∂äÁöÑÊé®ÁêÜËÉΩÂäõÂíåÂàõÈÄ†ÊÄßÔºåÈÄÇÂêàÂ§çÊùÇÁöÑÊñáÊú¨ÁîüÊàê„ÄÅÂàÜÊûêÂíåÂàõ‰Ωú‰ªªÂä°„ÄÇ'
            },
            'meta-llama/llama-3.3-70b-instruct': {
                name: 'Llama 3.3 70B',
                description: 'Â§ßÂûãÂèÇÊï∞Ê®°ÂûãÔºå‰∏ì‰∏∫Â§çÊùÇÊé®ÁêÜÂíåÊ∑±Â∫¶ÂàÜÊûêËÆæËÆ°ÔºåÂú®Êï∞Â≠¶„ÄÅÁßëÂ≠¶ÂíåÂì≤Â≠¶ÈóÆÈ¢ò‰∏äË°®Áé∞Âá∫Ëâ≤„ÄÇ'
            },
            'meta-llama/llama-3.1-8b-instruct': {
                name: 'Llama 3.1 8B',
                description: 'ËΩªÈáèÁ∫ßÈ´òÊïàÊ®°ÂûãÔºåÂìçÂ∫îÈÄüÂ∫¶Âø´ÔºåÈÄÇÂêàÊó•Â∏∏ÂØπËØù„ÄÅÁÆÄÂçï‰ªªÂä°ÂíåÂÆûÊó∂Â∫îÁî®Âú∫ÊôØ„ÄÇ'
            },
            'meta-llama/llama-guard-3-8b': {
                name: 'Llama Guard 3 8B',
                description: '‰∏ìÈó®ÁöÑÂÜÖÂÆπÂÆ°Ê†∏Ê®°ÂûãÔºåÁî®‰∫éÊ£ÄÊµãÊúâÂÆ≥ÂÜÖÂÆπ„ÄÅ‰∏çÂΩìË®ÄËÆ∫ÂíåÂÆâÂÖ®È£éÈô©ËØÑ‰º∞„ÄÇ'
            }
        };

        // È¢ÑËÆæÊèêÁ§∫ËØç
        const presetPrompts = {
            creative: "ÂÜô‰∏Ä‰∏™ÂÖ≥‰∫éÊú™Êù•ÁßëÊäÄÁöÑÂàõÊÑèÁü≠ÊïÖ‰∫ãÔºåÂåÖÂê´‰∫∫Â∑•Êô∫ËÉΩÂíå‰∫∫Á±ªÁöÑ‰∫íÂä®„ÄÇ",
            technical: "ËØ¶ÁªÜËß£ÈáäÈáèÂ≠êËÆ°ÁÆóÁöÑÂü∫Êú¨ÂéüÁêÜÔºå‰ª•ÂèäÂÆÉÂØπÁé∞‰ª£ÂØÜÁ†ÅÂ≠¶ÁöÑÂΩ±Âìç„ÄÇ",
            analysis: "ÂàÜÊûêÂΩìÂâçÂÖ®ÁêÉÊ∞îÂÄôÂèòÂåñÁöÑ‰∏ªË¶ÅÂéüÂõ†ÂíåÂèØËÉΩÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇ",
            coding: "Áî® Python ÁºñÂÜô‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊú∫Âô®Â≠¶‰π†ÂàÜÁ±ªÂô®ÔºåÂπ∂Ëß£ÈáäÊØè‰∏™Ê≠•È™§„ÄÇ",
            moderation: "ËøôÊù°Ê∂àÊÅØÊòØÂê¶ÂåÖÂê´ÊúâÂÆ≥ÂÜÖÂÆπÔºö'ÊàëÂñúÊ¨¢Âú®Âë®Êú´ÂéªÂæíÊ≠•ÊóÖË°åÔºå‰∫´ÂèóÂ§ßËá™ÁÑ∂ÁöÑÁæéÊôØ„ÄÇ'",
            tutorial: "ÂàõÂª∫‰∏Ä‰∏™ÂÖ≥‰∫éÂ¶Ç‰ΩïÊûÑÂª∫ React Â∫îÁî®Á®ãÂ∫èÁöÑËØ¶ÁªÜÊïôÁ®ã„ÄÇ"
        };

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateModelInfo();
            updateStats();
            loadHistory();
            
            // Ê®°ÂûãÈÄâÊã©Âô®‰∫ã‰ª∂
            document.getElementById('llamaModel').addEventListener('change', updateModelInfo);
        });

        // Êõ¥Êñ∞Ê®°Âûã‰ø°ÊÅØ
        function updateModelInfo() {
            const selectedModel = document.getElementById('llamaModel').value;
            const info = modelInfo[selectedModel];
            const infoDiv = document.getElementById('modelInfo');
            
            infoDiv.innerHTML = `
                <h4>${info.name}</h4>
                <p>${info.description}</p>
            `;
        }

        // ËÆæÁΩÆÈ¢ÑËÆæÊèêÁ§∫ËØç
        function setPresetPrompt(type) {
            const prompt = presetPrompts[type];
            document.getElementById('userPrompt').value = prompt;
            
            // Â¶ÇÊûúÊòØÂÜÖÂÆπÂÆ°Ê†∏ÔºåËá™Âä®ÈÄâÊã© Llama Guard
            if (type === 'moderation') {
                document.getElementById('llamaModel').value = 'meta-llama/llama-guard-3-8b';
                updateModelInfo();
            }
        }

        // ÂèëÈÄÅ Llama ËØ∑Ê±Ç
        async function sendLlamaRequest() {
            const prompt = document.getElementById('userPrompt').value.trim();
            const model = document.getElementById('llamaModel').value;
            
            if (!prompt) {
                alert('ËØ∑ËæìÂÖ•ÊèêÁ§∫ËØç');
                return;
            }

            const loading = document.getElementById('loading');
            const responseArea = document.getElementById('responseArea');
            
            loading.classList.add('active');
            responseArea.textContent = 'Ê≠£Âú®ÁîüÊàêÂìçÂ∫î...';

            const startTime = Date.now();

            try {
                const response = await puter.ai.chat(prompt, { model: model });
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                const content = response.message.content;
                responseArea.textContent = content;

                // Êõ¥Êñ∞ÁªüËÆ°
                updateStatsAfterRequest(model, responseTime, content.length);
                
                // ‰øùÂ≠òÂà∞ÂéÜÂè≤
                saveToHistory(prompt, content, model, responseTime);

            } catch (error) {
                responseArea.innerHTML = `<div class="error-message">ÈîôËØØ: ${error.message}</div>`;
            } finally {
                loading.classList.remove('active');
            }
        }

        // ÊµÅÂºèÂìçÂ∫î
        async function sendStreamingRequest() {
            const prompt = document.getElementById('userPrompt').value.trim();
            const model = document.getElementById('llamaModel').value;
            
            if (!prompt) {
                alert('ËØ∑ËæìÂÖ•ÊèêÁ§∫ËØç');
                return;
            }

            const loading = document.getElementById('loading');
            const streamingIndicator = document.getElementById('streamingIndicator');
            const responseArea = document.getElementById('responseArea');
            
            loading.classList.add('active');
            streamingIndicator.classList.add('active');
            responseArea.textContent = '';

            const startTime = Date.now();
            let fullResponse = '';

            try {
                const response = await puter.ai.chat(prompt, { 
                    model: model,
                    stream: true 
                });

                for await (const part of response) {
                    if (part?.text) {
                        fullResponse += part.text;
                        responseArea.textContent = fullResponse;
                        responseArea.scrollTop = responseArea.scrollHeight;
                    }
                }

                const endTime = Date.now();
                const responseTime = endTime - startTime;

                // Êõ¥Êñ∞ÁªüËÆ°
                updateStatsAfterRequest(model, responseTime, fullResponse.length);
                
                // ‰øùÂ≠òÂà∞ÂéÜÂè≤
                saveToHistory(prompt, fullResponse, model, responseTime);

            } catch (error) {
                responseArea.innerHTML = `<div class="error-message">ÈîôËØØ: ${error.message}</div>`;
            } finally {
                loading.classList.remove('active');
                streamingIndicator.classList.remove('active');
            }
        }

        // Ê®°ÂûãÂØπÊØî
        async function runComparison() {
            const prompt = document.getElementById('comparisonPrompt').value.trim();
            
            if (!prompt) {
                alert('ËØ∑ËæìÂÖ•ÂØπÊØîÊèêÁ§∫ËØç');
                return;
            }

            const loading = document.getElementById('comparisonLoading');
            const resultsContainer = document.getElementById('comparisonResults');
            
            loading.classList.add('active');
            resultsContainer.innerHTML = '';

            const models = [
                'meta-llama/llama-4-maverick',
                'meta-llama/llama-3.3-70b-instruct',
                'meta-llama/llama-3.1-8b-instruct'
            ];

            const promises = models.map(async (model) => {
                const startTime = Date.now();
                try {
                    const response = await puter.ai.chat(prompt, { model: model });
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    return {
                        model: model,
                        content: response.message.content,
                        responseTime: responseTime,
                        success: true
                    };
                } catch (error) {
                    return {
                        model: model,
                        content: `ÈîôËØØ: ${error.message}`,
                        responseTime: 0,
                        success: false
                    };
                }
            });

            try {
                const results = await Promise.all(promises);
                
                results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = 'comparison-item';
                    
                    const modelName = modelInfo[result.model].name;
                    
                    div.innerHTML = `
                        <div class="comparison-header">
                            <span>${modelName}</span>
                            <span class="response-time">${result.responseTime}ms</span>
                        </div>
                        <div class="history-response">${result.content}</div>
                    `;
                    
                    resultsContainer.appendChild(div);
                    
                    if (result.success) {
                        updateStatsAfterRequest(result.model, result.responseTime, result.content.length);
                        saveToHistory(prompt, result.content, result.model, result.responseTime);
                    }
                });

            } catch (error) {
                resultsContainer.innerHTML = `<div class="error-message">ÂØπÊØîËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ: ${error.message}</div>`;
            } finally {
                loading.classList.remove('active');
            }
        }

        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        function updateStatsAfterRequest(model, responseTime, tokenCount) {
            stats.totalRequests++;
            stats.modelsUsed.add(model);
            stats.responseTimes.push(responseTime);
            stats.totalTokens += tokenCount;
            
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalRequests').textContent = stats.totalRequests;
            document.getElementById('modelsUsed').textContent = stats.modelsUsed.size;
            
            const avgTime = stats.responseTimes.length > 0 
                ? Math.round(stats.responseTimes.reduce((a, b) => a + b, 0) / stats.responseTimes.length)
                : 0;
            document.getElementById('avgResponseTime').textContent = avgTime + 'ms';
            
            document.getElementById('totalTokens').textContent = stats.totalTokens.toLocaleString();
        }

        // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
        function saveToHistory(prompt, response, model, responseTime) {
            const historyItem = {
                id: Date.now(),
                prompt: prompt,
                response: response,
                model: model,
                responseTime: responseTime,
                timestamp: new Date().toLocaleString()
            };
            
            history.unshift(historyItem);
            
            // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
            if (history.length > 50) {
                history = history.slice(0, 50);
            }
            
            localStorage.setItem('llamaHistory', JSON.stringify(history));
            loadHistory();
        }

        // Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï
        function loadHistory() {
            const container = document.getElementById('historyContainer');
            
            if (history.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</p>';
                return;
            }
            
            container.innerHTML = history.map(item => `
                <div class="history-item">
                    <div class="history-header">
                        <span class="history-model">${modelInfo[item.model].name}</span>
                        <span class="history-time">${item.timestamp} (${item.responseTime}ms)</span>
                    </div>
                    <div class="history-prompt">ÈóÆÈ¢ò: ${item.prompt}</div>
                    <div class="history-response">${item.response}</div>
                </div>
            `).join('');
        }

        // Ê∏ÖÁ©∫ÂìçÂ∫î
        function clearResponse() {
            document.getElementById('responseArea').textContent = 'Á≠âÂæÖÊÇ®ÁöÑËæìÂÖ•...';
        }

        // Ê∏ÖÁ©∫ÂØπÊØî
        function clearComparison() {
            document.getElementById('comparisonResults').innerHTML = '';
        }

        // ÂØºÂá∫ÂéÜÂè≤ËÆ∞ÂΩï
        function exportHistory() {
            if (history.length === 0) {
                alert('Ê≤°ÊúâÂéÜÂè≤ËÆ∞ÂΩïÂèØÂØºÂá∫');
                return;
            }
            
            const dataStr = JSON.stringify(history, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `llama-history-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // Ê∏ÖÁ©∫ÂéÜÂè≤ËÆ∞ÂΩï
        function clearHistory() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºü')) {
                history = [];
                localStorage.removeItem('llamaHistory');
                loadHistory();
            }
        }

        // ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        sendLlamaRequest();
                        break;
                    case 'k':
                        e.preventDefault();
                        clearResponse();
                        break;
                }
            }
        });

        // ÊòæÁ§∫Âø´Êç∑ÈîÆÊèêÁ§∫
        console.log('üî• Âú∞Áã±‰πãÈó® Llama API ÊºîÁ§∫Âø´Êç∑ÈîÆ:');
        console.log('Ctrl/Cmd + Enter: ÂèëÈÄÅËØ∑Ê±Ç');
        console.log('Ctrl/Cmd + K: Ê∏ÖÁ©∫ÂìçÂ∫î');
    </script>
</body>
</html>